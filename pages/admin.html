<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DarkOS â€“ Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700;800;900&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg:#08090f; --surface:#13151f; --surface2:#1a1d2e; --surface3:#20243a;
      --border:rgba(255,255,255,0.07); --text:#eef0f8; --text-dim:#6b7a99;
      --accent:#7f5af0; --accent2:#2cb67d; --accent3:#ff4757; --accent4:#f4a229;
      --glow:rgba(127,90,240,0.25);
      --font-head:'Oxanium',sans-serif; --font-mono:'DM Mono',monospace;
    }
    [data-theme="light"] {
      --bg:#f0f2f7; --surface:#ffffff; --surface2:#f7f9fc; --surface3:#edf0f7;
      --border:rgba(0,0,0,0.08); --text:#0d0f1a; --text-dim:#6b7280;
      --accent:#5b3de8; --accent2:#0ea5a0; --accent3:#e84040; --accent4:#d08a10;
      --glow:rgba(91,61,232,0.15);
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{background:var(--bg);color:var(--text);font-family:var(--font-mono);font-size:14px;line-height:1.6;min-height:100vh}
    .layout{display:grid;grid-template-columns:220px 1fr;min-height:100vh}

    /* Sidebar */
    .sidebar{background:var(--surface);border-right:1px solid var(--border);padding:1.2rem 0.8rem;display:flex;flex-direction:column;gap:0.15rem;position:sticky;top:0;height:100vh;overflow-y:auto}
    .sidebar-logo{font-family:var(--font-head);font-weight:900;font-size:1.1rem;color:var(--text);padding:0.4rem 0.6rem 1rem;margin-bottom:0.2rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
    .sidebar-logo em{color:var(--accent);font-style:normal}
    .theme-btn{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:0.28rem 0.4rem;cursor:pointer;font-size:0.82rem;color:var(--text-dim);transition:all 0.2s}
    .theme-btn:hover{color:var(--text);border-color:var(--accent)}
    .sidebar-section{font-size:0.62rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.12em;padding:0.9rem 0.6rem 0.25rem}
    .nav-btn{display:flex;align-items:center;gap:0.6rem;padding:0.5rem 0.75rem;border-radius:6px;cursor:pointer;font-family:var(--font-mono);font-size:0.82rem;color:var(--text-dim);transition:all 0.15s;border:none;background:none;width:100%;text-align:left}
    .nav-btn:hover{background:var(--surface2);color:var(--text)}
    .nav-btn.active{background:rgba(127,90,240,0.15);color:var(--accent)}
    [data-theme="light"] .nav-btn.active{background:rgba(91,61,232,0.1)}
    .sidebar-bottom{margin-top:auto;display:flex;flex-direction:column;gap:0.4rem;padding-top:0.8rem;border-top:1px solid var(--border)}
    .user-row{display:flex;align-items:center;gap:0.6rem;padding:0.5rem 0.6rem;border-radius:8px;background:var(--surface2)}
    .user-row img{width:28px;height:28px;border-radius:50%;object-fit:cover}
    .user-row span{font-size:0.8rem}
    .badge-admin{background:rgba(127,90,240,0.2);color:var(--accent);font-size:0.6rem;padding:0.1rem 0.4rem;border-radius:999px;display:block;width:fit-content}
    .btn-logout{display:flex;align-items:center;gap:0.5rem;padding:0.45rem 0.75rem;border-radius:6px;cursor:pointer;font-family:var(--font-mono);font-size:0.8rem;color:var(--accent3);border:1px solid rgba(255,71,87,0.2);background:rgba(255,71,87,0.05);width:100%;transition:all 0.15s}
    .btn-logout:hover{background:rgba(255,71,87,0.12);border-color:var(--accent3)}

    /* Main */
    .main{padding:2rem 2.5rem;overflow-y:auto;max-height:100vh}
    .page{display:none} .page.active{display:block}
    .page-header{margin-bottom:1.8rem}
    .page-title{font-family:var(--font-head);font-size:1.4rem;font-weight:800;margin-bottom:0.3rem}
    .page-sub{font-size:0.82rem;color:var(--text-dim)}

    /* Cards */
    .card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:1.4rem;margin-bottom:1.2rem}
    .card-title{font-family:var(--font-head);font-size:0.88rem;font-weight:600;margin-bottom:1.1rem;display:flex;align-items:center;gap:0.5rem}
    .card-title-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.1rem}

    /* Stats */
    .stat-row{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:1rem;margin-bottom:1.5rem}
    .stat-box{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1.1rem;text-align:center;position:relative;overflow:hidden;transition:transform 0.2s,box-shadow 0.2s}
    .stat-box:hover{transform:translateY(-2px);box-shadow:0 4px 20px var(--glow)}
    .stat-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--accent)}
    .stat-box-num{font-family:var(--font-head);font-size:1.9rem;font-weight:800;color:var(--accent)}
    .stat-box-lbl{font-size:0.68rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.08em;margin-top:0.2rem}

    /* Forms */
    .form-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem}
    .field label{display:block;font-size:0.7rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:0.35rem}
    .field input,.field select,.field textarea{width:100%;padding:0.5rem 0.75rem;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-family:var(--font-mono);font-size:0.82rem;outline:none;transition:border-color 0.2s,box-shadow 0.2s}
    .field textarea{resize:vertical;min-height:80px}
    .field input:focus,.field select:focus,.field textarea:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(127,90,240,0.12)}
    .field select option{background:var(--surface)}
    .field .hint{font-size:0.67rem;color:var(--text-dim);margin-top:0.3rem}
    .field-full{grid-column:1/-1}

    /* Buttons */
    .btn{display:inline-flex;align-items:center;gap:0.4rem;padding:0.5rem 1.1rem;background:var(--accent);color:#fff;border:none;border-radius:6px;font-family:var(--font-head);font-size:0.78rem;font-weight:600;cursor:pointer;transition:all 0.2s}
    .btn:hover{filter:brightness(1.15);box-shadow:0 0 18px var(--glow)}
    .btn-green{background:var(--accent2)} .btn-green:hover{box-shadow:0 0 18px rgba(44,182,125,0.3)}
    .btn-danger{background:var(--accent3)} .btn-danger:hover{box-shadow:0 0 18px rgba(255,71,87,0.3)}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text-dim)} .btn-ghost:hover{border-color:var(--accent);color:var(--text);box-shadow:none;filter:none}
    .btn-sm{padding:0.28rem 0.65rem;font-size:0.7rem}
    .btn-row{display:flex;gap:0.6rem;align-items:center;flex-wrap:wrap;margin-top:1.2rem}

    /* Table */
    .tbl{width:100%;border-collapse:collapse;font-size:0.82rem}
    .tbl th{padding:0.45rem 0.75rem;text-align:left;color:var(--text-dim);font-weight:400;font-size:0.68rem;text-transform:uppercase;letter-spacing:0.06em;border-bottom:1px solid var(--border)}
    .tbl td{padding:0.55rem 0.75rem;border-bottom:1px solid var(--border);vertical-align:middle}
    .tbl tr:last-child td{border-bottom:none}
    .tbl tr:hover td{background:rgba(127,90,240,0.04)}
    .tbl-empty{color:var(--text-dim);padding:1.5rem 0.75rem!important}

    /* Pills */
    .pill{padding:0.18rem 0.5rem;border-radius:999px;font-size:0.66rem;white-space:nowrap;display:inline-block}
    .pill-purple{background:rgba(127,90,240,0.15);color:var(--accent)}
    .pill-green{background:rgba(44,182,125,0.15);color:var(--accent2)}
    .pill-red{background:rgba(255,71,87,0.15);color:var(--accent3)}
    .pill-yellow{background:rgba(244,162,41,0.15);color:var(--accent4)}

    /* Alerts */
    .alert{border-radius:8px;padding:0.75rem 1rem;font-size:0.81rem;margin-bottom:1rem;display:flex;align-items:flex-start;gap:0.5rem}
    .alert-info{background:rgba(127,90,240,0.08);border:1px solid rgba(127,90,240,0.2);color:var(--accent)}
    .alert-warn{background:rgba(244,162,41,0.08);border:1px solid rgba(244,162,41,0.2);color:var(--accent4)}
    .alert-danger{background:rgba(255,71,87,0.08);border:1px solid rgba(255,71,87,0.2);color:var(--accent3)}
    .alert-ok{background:rgba(44,182,125,0.08);border:1px solid rgba(44,182,125,0.2);color:var(--accent2)}

    /* Toast */
    .toast{position:fixed;bottom:1.5rem;right:1.5rem;background:var(--surface);border:1px solid var(--border);color:var(--text);padding:0.7rem 1.2rem;border-radius:8px;font-size:0.82rem;opacity:0;transform:translateY(10px);transition:opacity 0.25s,transform 0.25s;pointer-events:none;z-index:9999;box-shadow:0 8px 32px rgba(0,0,0,0.4);max-width:320px}
    .toast.show{opacity:1;transform:translateY(0)}

    /* Login */
    .login-overlay{position:fixed;inset:0;z-index:500;background:var(--bg);display:flex;align-items:center;justify-content:center}
    .login-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:2.8rem 2.4rem;max-width:400px;width:90%;text-align:center}
    .login-logo{font-family:var(--font-head);font-size:2rem;font-weight:900;margin-bottom:0.5rem}
    .login-logo em{color:var(--accent);font-style:normal}
    .login-card p{color:var(--text-dim);font-size:0.83rem;margin-bottom:2rem;line-height:1.7}
    .btn-discord{display:inline-flex;align-items:center;justify-content:center;gap:0.7rem;width:100%;padding:0.8rem 2rem;background:#5865F2;color:#fff;border:none;border-radius:8px;font-family:var(--font-head);font-size:0.9rem;font-weight:600;cursor:pointer;transition:all 0.2s}
    .btn-discord:hover{background:#4752c4;box-shadow:0 0 28px rgba(88,101,242,0.4)}
    .login-err{color:var(--accent3);font-size:0.78rem;margin-top:1rem;min-height:1.2rem}

    /* War Feed */
    .conflict-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:0.8rem}
    .conflict-card{background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:1rem;display:flex;flex-direction:column;gap:0.6rem}
    .conflict-card-top{display:flex;align-items:center;justify-content:space-between}
    .conflict-name{font-family:var(--font-head);font-size:0.85rem;font-weight:600}
    .toggle{position:relative;width:36px;height:20px}
    .toggle input{opacity:0;width:0;height:0}
    .toggle-slider{position:absolute;inset:0;background:var(--surface3);border-radius:999px;cursor:pointer;transition:0.2s;border:1px solid var(--border)}
    .toggle-slider::before{content:'';position:absolute;width:14px;height:14px;left:2px;top:2px;background:var(--text-dim);border-radius:50%;transition:0.2s}
    .toggle input:checked+.toggle-slider{background:var(--accent);border-color:var(--accent)}
    .toggle input:checked+.toggle-slider::before{transform:translateX(16px);background:#fff}
    .conflict-status{font-size:0.7rem;color:var(--text-dim)}

    ::-webkit-scrollbar{width:5px}
    ::-webkit-scrollbar-track{background:transparent}
    ::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}
    .logo-img{height:22px;width:auto;object-fit:contain;display:block}
    .login-logo-img{height:48px;width:auto;margin:0 auto 0.8rem;display:block}
    .lang-btn,.ctrl-btn{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:0.28rem 0.5rem;cursor:pointer;font-size:0.7rem;font-family:var(--font-mono);color:var(--text-dim);transition:all 0.2s;letter-spacing:0.05em}
    .lang-btn:hover,.ctrl-btn:hover{color:var(--text);border-color:var(--accent)}
    .sidebar-controls{display:flex;gap:0.3rem;align-items:center}
  </style>
</head>
<body>
<script>(function(){
  var t=localStorage.getItem('dkos-theme')||'dark';
  document.documentElement.setAttribute('data-theme',t);
  document.addEventListener('DOMContentLoaded',function(){
    var b=document.getElementById('themeBtn');
    if(b) b.textContent=t==='dark'?'â˜€ï¸':'ğŸŒ™';
    var logo=t==='dark'?'../assets/logo.png':'../assets/logo_white.png';
    ['sidebarLogo','loginLogo'].forEach(function(id){var el=document.getElementById(id);if(el)el.src=logo;});
    var lb=document.getElementById('langBtn');
    if(lb){var lang=localStorage.getItem('dkos-lang')||'de';lb.textContent=lang==='de'?'ENG':'DEU';}
  });
})();</script>

<!-- Login -->
<div class="login-overlay" id="loginOverlay">
  <div class="login-card">
    <img id="loginLogo" src="../assets/logo.png" alt="DarkOS" style="height:50px;width:auto;margin:0 auto 1rem;display:block" />
    <p><span data-i18n="login-desc">Melde dich mit Discord an.<br>Du benÃ¶tigst die <strong>Admin-Rolle</strong> auf dem Community Server.</span></p>
    <button class="btn-discord" onclick="doLogin()">
      <svg width="18" height="14" viewBox="0 0 127.14 96.36" fill="currentColor"><path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/></svg>
      <span data-i18n="login-btn">Login with Discord</span>
    </button>
    <div class="login-err" id="loginErr"></div>
  </div>
</div>

<!-- Dashboard -->
<div class="layout" id="dashboard" style="display:none">
  <aside class="sidebar">
    <div class="sidebar-logo">
      <img id="sidebarLogo" src="../assets/logo.png" alt="DarkOS" style="height:26px;width:auto" />
      <div style="display:flex;gap:0.35rem">
        <button class="ctrl-btn" id="langBtn" onclick="toggleLang()">ENG</button>
        <button class="ctrl-btn" id="themeBtn" onclick="toggleTheme()">ğŸŒ™</button>
      </div>
    </div>

    <div class="sidebar-section" data-i18n="nav-overview">Ãœbersicht</div>
    <button class="nav-btn active" onclick="show('overview',this)">ğŸ“Š <span data-i18n="page-overview-title">Statistiken</span></button>

    <div class="sidebar-section" data-i18n="nav-config">Konfiguration</div>
    <button class="nav-btn" onclick="show('bot-setup',this)">âš™ï¸ Bot Setup</button>
    <button class="nav-btn" onclick="show('logs',this)">ğŸ“‹ Log Channels</button>
    <button class="nav-btn" onclick="show('subscriptions',this)">ğŸ”” Subscriptions</button>
    <button class="nav-btn" onclick="show('warfeed',this)">ğŸŒ War Feed</button>
    <button class="nav-btn" onclick="show('customcmds',this)">ğŸ’¬ <span data-i18n="nav-customcmds">Eigene Commands</span></button>

    <div class="sidebar-section" data-i18n="nav-tools">Tools</div>
    <button class="nav-btn" onclick="show('giveaway',this)">ğŸ‰ Giveaways</button>
    <button class="nav-btn" onclick="show('tickets',this)">ğŸ« Tickets</button>

    <div class="sidebar-bottom">
      <div class="user-row">
        <img id="uAvatar" src="https://cdn.discordapp.com/embed/avatars/0.png" alt="Avatar" />
        <div>
          <span id="uName">â€”</span>
          <span class="badge-admin">Admin</span>
        </div>
      </div>
      <button class="btn-logout" onclick="logout()">ğŸšª <span data-i18n="nav-logout">Abmelden</span></button>
    </div>
  </aside>

  <main class="main">

    <!-- Overview -->
    <div class="page active" id="page-overview">
      <div class="page-header">
        <div class="page-title">ğŸ“Š <span data-i18n="page-overview-title">Statistiken</span></div>
        <div class="page-sub"><span data-i18n="page-overview-sub">Live-Daten deines Servers.</span> <a href="#" onclick="loadStats();return false" style="color:var(--accent)">â†» Refresh</a></div>
      </div>
      <div class="stat-row">
        <div class="stat-box"><div class="stat-box-num" id="dMembers">â€”</div><div class="stat-box-lbl" data-i18n="stat-members">Mitglieder</div></div>
        <div class="stat-box"><div class="stat-box-num" id="dTickets">â€”</div><div class="stat-box-lbl">Tickets</div></div>
        <div class="stat-box"><div class="stat-box-num" id="dMessages">â€”</div><div class="stat-box-lbl" data-i18n="stat-messages">Nachrichten</div></div>
        <div class="stat-box"><div class="stat-box-num" id="dJoins">â€”</div><div class="stat-box-lbl" data-i18n="stat-joins">Beitritte</div></div>
        <div class="stat-box"><div class="stat-box-num" id="dLeaves">â€”</div><div class="stat-box-lbl" data-i18n="stat-leaves">Verlassen</div></div>
        <div class="stat-box"><div class="stat-box-num" id="dUptime">â€”</div><div class="stat-box-lbl">Uptime</div></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ¤– Bot Status</div>
        <div style="display:flex;gap:2.5rem;flex-wrap:wrap">
          <div><div style="font-size:0.7rem;color:var(--text-dim);margin-bottom:0.3rem">VERSION</div><div id="sBotVersion" style="font-family:var(--font-head);color:var(--accent)">â€”</div></div>
          <div><div style="font-size:0.7rem;color:var(--text-dim);margin-bottom:0.3rem">NAME</div><div id="sBotName" style="font-family:var(--font-head)">â€”</div></div>
          <div><div style="font-size:0.7rem;color:var(--text-dim);margin-bottom:0.3rem">API</div><div id="sApiStatus">â€”</div></div>
        </div>
      </div>
    </div>

    <!-- Bot Setup -->
    <div class="page" id="page-bot-setup">
      <div class="page-header">
        <div class="page-title">âš™ï¸ Bot Setup</div>
        <div class="page-sub">IDs hier eintragen â€” kein .env Edit nÃ¶tig!</div>
      </div>
      <div class="alert alert-info">ğŸ’¡ Ã„nderungen werden sofort gespeichert. Kein Neustart nÃ¶tig.</div>
      <div class="card">
        <div class="card-title">ğŸ–¥ï¸ Server IDs</div>
        <div class="form-grid">
          <div class="field"><label>Community Server ID</label><input type="text" id="s_community_server_id" placeholder="Rechtsklick Server â†’ ID kopieren" /><div class="hint">Dein Ã¶ffentlicher Server</div></div>
          <div class="field"><label>Team Server ID</label><input type="text" id="s_team_server_id" placeholder="Privater Team-Server ID" /><div class="hint">FÃ¼r anonyme Ticket-Antworten</div></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ‘¥ Rollen IDs</div>
        <div class="form-grid">
          <div class="field"><label>Admin Rolle ID</label><input type="text" id="s_admin_role_id" placeholder="Admin Rolle" /><div class="hint">Dashboard-Zugang</div></div>
          <div class="field"><label>Team Rolle ID</label><input type="text" id="s_team_role_id" placeholder="Team Rolle" /><div class="hint">Ticket-Portal</div></div>
          <div class="field"><label>Moderator Rolle ID</label><input type="text" id="s_moderator_role_id" placeholder="Moderator Rolle" /></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ« Ticket Einstellungen</div>
        <div class="form-grid">
          <div class="field"><label>Ticket Kategorie ID</label><input type="text" id="s_ticket_category_id" placeholder="Kategorie fÃ¼r Ticket-KanÃ¤le" /></div>
          <div class="field"><label>Ticket Log Channel ID</label><input type="text" id="s_ticket_log_channel_id" placeholder="Wo Admin-Transkripte landen" /></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“¢ Benachrichtigungs-Channels</div>
        <div class="form-grid">
          <div class="field"><label>Giveaway</label><input type="text" id="s_giveaway_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>War Feed</label><input type="text" id="s_war_feed_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>Anime News</label><input type="text" id="s_anime_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>Counting</label><input type="text" id="s_counting_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>Driver Updates</label><input type="text" id="s_driver_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>Twitch Announcements</label><input type="text" id="s_twitch_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>YouTube Announcements</label><input type="text" id="s_youtube_channel_id" placeholder="Channel ID" /></div>
          <div class="field"><label>Announce Channel</label><input type="text" id="s_announce_channel_id" placeholder="Channel ID" /></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ¨ Erscheinungsbild</div>
        <div class="form-grid">
          <div class="field"><label>Bot Name</label><input type="text" id="s_bot_name" placeholder="DarkOS" /></div>
          <div class="field"><label>Embed Farbe (Hex)</label><input type="text" id="s_bot_color" placeholder="#7f5af0" /></div>
          <div class="field field-full"><label>Willkommensnachricht</label><input type="text" id="s_welcome_message" placeholder="Willkommen {user} auf {server}! â€” Platzhalter: {user} {username} {server} {count}" /></div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-green" onclick="saveSettings()">ğŸ’¾ Speichern</button>
        <button class="btn btn-ghost" onclick="loadSettings()">â†º Neu laden</button>
      </div>
    </div>

    <!-- Log Channels -->
    <div class="page" id="page-logs">
      <div class="page-header">
        <div class="page-title">ğŸ“‹ Log Channels</div>
        <div class="page-sub">Konfiguriere wo welche Logs landen.</div>
      </div>
      <div class="card">
        <div class="form-grid">
          <div class="field"><label>ğŸ”´ Reports (Bans/Mutes/Timeouts)</label><input type="text" id="l_reports" placeholder="Channel ID" /></div>
          <div class="field"><label>ğŸ”µ Server Logs</label><input type="text" id="l_server" placeholder="Channel ID" /></div>
          <div class="field"><label>ğŸ¤ Voice Logs</label><input type="text" id="l_voice" placeholder="Channel ID" /></div>
          <div class="field"><label>ğŸ‘¥ Member Logs</label><input type="text" id="l_member" placeholder="Channel ID" /></div>
          <div class="field"><label>ğŸ’¬ Message Logs</label><input type="text" id="l_message" placeholder="Channel ID" /></div>
          <div class="field"><label>ğŸ”— Invite Logger</label><input type="text" id="l_invite" placeholder="Channel ID" /></div>
        </div>
        <div class="btn-row">
          <button class="btn" onclick="saveLogs()">ğŸ’¾ Log Config speichern</button>
          <button class="btn btn-ghost" onclick="loadSettings()">â†º Neu laden</button>
        </div>
      </div>
    </div>

    <!-- Subscriptions -->
    <div class="page" id="page-subscriptions">
      <div class="page-header">
        <div class="page-title">ğŸ”” Subscriptions</div>
        <div class="page-sub">Anime, Twitch, YouTube und Driver Alerts.</div>
      </div>
      <div class="card">
        <div class="card-title">â• Subscription hinzufÃ¼gen</div>
        <div class="form-grid">
          <div class="field"><label>Typ</label>
            <select id="sub_type">
              <option value="anime">ğŸ“º Anime Episode</option>
              <option value="driver_nvidia">ğŸŸ¢ NVIDIA Driver</option>
              <option value="driver_amd">ğŸ”´ AMD Driver</option>
              <option value="driver_intel">ğŸ”µ Intel Driver</option>
              <option value="twitch">ğŸŸ£ Twitch Streamer</option>
              <option value="youtube">ğŸ”´ YouTube Channel</option>
            </select>
          </div>
          <div class="field"><label>Target</label><input type="text" id="sub_target" placeholder="Anime-Titel / Streamer / YouTube-ID" /></div>
          <div class="field"><label>Benachrichtigungs-Channel ID</label><input type="text" id="sub_channel" placeholder="Wohin soll der Alert?" /></div>
        </div>
        <div class="btn-row"><button class="btn btn-green" onclick="addSub()">â• HinzufÃ¼gen</button></div>
      </div>
      <div class="card">
        <div class="card-title-row">
          <div class="card-title" style="margin:0">Aktive Subscriptions</div>
          <button class="btn btn-ghost btn-sm" onclick="loadSubs()">â†º Refresh</button>
        </div>
        <table class="tbl">
          <thead><tr><th>Typ</th><th>Target</th><th>Channel ID</th><th></th></tr></thead>
          <tbody id="subsTbl"><tr><td class="tbl-empty" colspan="4">Laden...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- War Feed -->
    <div class="page" id="page-warfeed">
      <div class="page-header">
        <div class="page-title">ğŸŒ War Feed</div>
        <div class="page-sub">Automatische Konflikt-News in Discord Threads.</div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“¡ Parent Channel</div>
        <div class="form-grid">
          <div class="field"><label>Channel ID</label><input type="text" id="wf_channel" placeholder="Channel wo Threads erstellt werden" /><div class="hint">Threads werden automatisch pro Konflikt erstellt</div></div>
        </div>
        <div class="btn-row"><button class="btn btn-green" onclick="saveWarFeedChannel()">ğŸ’¾ Channel speichern</button></div>
      </div>
      <div class="card">
        <div class="card-title">âš”ï¸ Konflikte aktivieren</div>
        <div class="conflict-grid" id="conflictGrid"></div>
      </div>
    </div>

    <!-- Custom Commands -->
    <div class="page" id="page-customcmds">
      <div class="page-header">
        <div class="page-title">ğŸ’¬ Custom Commands</div>
        <div class="page-sub">Eigene Trigger und Antworten.</div>
      </div>
      <div class="card">
        <div class="card-title">â• Command hinzufÃ¼gen</div>
        <div class="form-grid">
          <div class="field"><label>Trigger</label><input type="text" id="cc_trigger" placeholder="z.B. !discord oder hallo" /></div>
          <div class="field"><label>Match-Typ</label>
            <select id="cc_match">
              <option value="exact">Exakt</option>
              <option value="contains">EnthÃ¤lt</option>
              <option value="startswith">Beginnt mit</option>
            </select>
          </div>
          <div class="field field-full"><label>Antwort</label><textarea id="cc_response" placeholder="Antwort. Platzhalter: {user} {username} {server}"></textarea></div>
        </div>
        <div class="btn-row"><button class="btn btn-green" onclick="addCustomCmd()">â• HinzufÃ¼gen</button></div>
      </div>
      <div class="card">
        <div class="card-title-row">
          <div class="card-title" style="margin:0">Aktive Commands</div>
          <button class="btn btn-ghost btn-sm" onclick="loadCustomCmds()">â†º Refresh</button>
        </div>
        <table class="tbl">
          <thead><tr><th>Trigger</th><th>Match</th><th>Antwort</th><th></th></tr></thead>
          <tbody id="ccTbl"><tr><td class="tbl-empty" colspan="4">Laden...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Giveaways -->
    <div class="page" id="page-giveaway">
      <div class="page-header">
        <div class="page-title">ğŸ‰ Giveaways</div>
        <div class="page-sub">Giveaways starten und verwalten.</div>
      </div>
      <div class="card">
        <div class="card-title">â• Neues Giveaway</div>
        <div class="form-grid">
          <div class="field"><label>Preis</label><input type="text" id="g_prize" placeholder="Was wird verlost?" /></div>
          <div class="field"><label>Channel ID</label><input type="text" id="g_channel" placeholder="Wo posten?" /></div>
          <div class="field"><label>Dauer (Minuten)</label><input type="number" id="g_duration" value="60" min="1" /></div>
          <div class="field"><label>Anzahl Gewinner</label><input type="number" id="g_winners" value="1" min="1" max="20" /></div>
        </div>
        <div class="btn-row"><button class="btn btn-green" onclick="createGiveaway()">ğŸ‰ Starten</button></div>
      </div>
      <div class="card">
        <div class="card-title-row">
          <div class="card-title" style="margin:0">ğŸŸ¢ Aktive Giveaways</div>
          <button class="btn btn-ghost btn-sm" onclick="loadGiveaways()">â†º Refresh</button>
        </div>
        <table class="tbl">
          <thead><tr><th>Preis</th><th>Endet</th><th>EintrÃ¤ge</th><th>Gewinner</th><th></th></tr></thead>
          <tbody id="gaTbl"><tr><td class="tbl-empty" colspan="5">Laden...</td></tr></tbody>
        </table>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“œ Vergangene Giveaways</div>
        <table class="tbl">
          <thead><tr><th>Preis</th><th>Beendet</th><th>EintrÃ¤ge</th><th>Gewinner</th></tr></thead>
          <tbody id="gaPastTbl"><tr><td class="tbl-empty" colspan="4">Laden...</td></tr></tbody>
        </table>
      </div>
    </div>

    <!-- Tickets -->
    <div class="page" id="page-tickets">
      <div class="page-header">
        <div class="page-title">ğŸ« Tickets</div>
        <div class="page-sub">Ãœbersicht aller Support-Tickets.</div>
      </div>
      <div class="alert alert-info">â„¹ï¸ Tickets werden auf Discord verwaltet. Hier siehst du die Ãœbersicht.</div>
      <div class="stat-row" style="grid-template-columns:repeat(3,1fr);max-width:380px">
        <div class="stat-box"><div class="stat-box-num" id="tOpen">â€”</div><div class="stat-box-lbl">Offen</div></div>
        <div class="stat-box"><div class="stat-box-num" id="tClosed">â€”</div><div class="stat-box-lbl">Geschlossen</div></div>
        <div class="stat-box"><div class="stat-box-num" id="tTotal">â€”</div><div class="stat-box-lbl">Gesamt</div></div>
      </div>
      <div class="card">
        <div class="card-title-row">
          <div class="card-title" style="margin:0">Offene Tickets</div>
          <button class="btn btn-ghost btn-sm" onclick="loadTickets()">â†º Refresh</button>
        </div>
        <table class="tbl">
          <thead><tr><th>#</th><th>User ID</th><th>Channel ID</th><th>Erstellt</th><th>Status</th></tr></thead>
          <tbody id="ticketTbl"><tr><td class="tbl-empty" colspan="5">Laden...</td></tr></tbody>
        </table>
      </div>
    </div>

  </main>
</div>

<div class="toast" id="toast"></div>

<!-- config.js laden â€“ Pfad ggf. anpassen! -->
<script src="../config.js" onerror="console.warn('[DarkOS] config.js nicht gefunden â€“ Pfad prÃ¼fen!')"></script>
<script>
// â•â• CONFIG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Liest window.DARKOS aus config.js (wird per <script src> oben geladen).
// Struktur: config.js im Root, admin.html in pages/ â†’ Pfad ../config.js ist korrekt.
function getCFG(k) {
  const src = window.DARKOS || {};
  return src[k] || '';
}
// Proxy damit CONFIG.clientId etc. immer den aktuellen Wert liest
const CONFIG = new Proxy({}, { get: (_, k) => getCFG(k) });

// â•â• OAUTH2 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let accessToken = null;

function doLogin() {
  const clientId = getCFG('clientId');
  if (!clientId) { showErr('âŒ clientId fehlt in CONFIG! PrÃ¼fe config.js'); return; }
  const redirect = window.location.href.split('?')[0].split('#')[0];
  const url = 'https://discord.com/oauth2/authorize'
    + '?client_id=' + encodeURIComponent(clientId)
    + '&response_type=token'
    + '&redirect_uri=' + encodeURIComponent(redirect)
    + '&scope=identify+guilds';
  window.location.href = url;
}

async function handleToken(token) {
  try {
    const user = await (await fetch('https://discord.com/api/users/@me', { headers:{Authorization:'Bearer '+token} })).json();
    if (!user.id) { showErr('âŒ Login fehlgeschlagen.'); return; }
    const guilds = await (await fetch('https://discord.com/api/users/@me/guilds', { headers:{Authorization:'Bearer '+token} })).json();
    const guild  = Array.isArray(guilds) && guilds.find(g => g.id === CONFIG.guildId);
    if (!guild) { showErr('âŒ Du bist nicht im Community Server.'); return; }
    if (!guild.owner && (BigInt(guild.permissions) & BigInt(0x8)) === BigInt(0)) { showErr('âŒ Keine Administrator-Rechte.'); return; }
    accessToken = token;
    sessionStorage.setItem('dkos_token', token);
    sessionStorage.setItem('dkos_user', JSON.stringify(user));
    showDash(user);
    window.history.replaceState({}, '', window.location.pathname);
  } catch(e) { showErr('âŒ ' + e.message); }
}

function logout() { sessionStorage.clear(); location.reload(); }
function showErr(m) { document.getElementById('loginErr').textContent = m; }

function showDash(user) {
  document.getElementById('loginOverlay').style.display = 'none';
  document.getElementById('dashboard').style.display   = 'grid';
  document.getElementById('uName').textContent = user.global_name || user.username || '?';
  if (user.avatar) document.getElementById('uAvatar').src = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=64`;
  loadStats(); loadSettings(); renderConflictGrid();
}

window.addEventListener('load', () => {
  // Init theme & lang
  applyTheme(localStorage.getItem('dkos-theme') || 'dark');
  currentLang = localStorage.getItem('dkos-lang') || 'de';
  applyLang();

  // OAuth
  const hash  = new URLSearchParams(window.location.hash.slice(1));
  const token = hash.get('access_token') || sessionStorage.getItem('dkos_token');
  const user  = sessionStorage.getItem('dkos_user');
  if (hash.get('access_token')) { handleToken(hash.get('access_token')); return; }
  if (token && user) { accessToken = token; showDash(JSON.parse(user)); }
});

// â•â• LANG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentLang = localStorage.getItem('dkos-lang') || 'de';

const TRANSLATIONS = {
  // sidebar sections
  'nav-overview':       { de: 'Ãœbersicht',       en: 'Overview' },
  'nav-config':         { de: 'Konfiguration',   en: 'Configuration' },
  'nav-tools':          { de: 'Tools',            en: 'Tools' },
  'nav-customcmds':     { de: 'Eigene Commands',  en: 'Custom Commands' },
  'nav-logout':         { de: 'Abmelden',         en: 'Logout' },
  // login
  'login-desc':         { de: '<span data-i18n="login-desc">Melde dich mit Discord an.<br>Du benÃ¶tigst die <strong>Admin-Rolle</strong> auf dem Community Server.</span>', en: 'Sign in with Discord.<br>You need the <strong>Admin role</strong> on the community server.' },
  'login-btn':          { de: 'Mit Discord anmelden', en: 'Login with Discord' },
  // overview
  'page-overview-title':{ de: 'Statistiken',       en: 'Statistics' },
  'page-overview-sub':  { de: 'Live-Daten deines Servers.', en: 'Live data from your server.' },
  'stat-members':       { de: 'Mitglieder',        en: 'Members' },
  'stat-messages':      { de: 'Nachrichten',       en: 'Messages' },
  'stat-joins':         { de: 'Beitritte',         en: 'Joins' },
  'stat-leaves':        { de: 'Verlassen',         en: 'Leaves' },
  // bot-setup
  'setup-sub':          { de: 'IDs hier eintragen â€” kein .env Edit nÃ¶tig!', en: 'Enter IDs here â€” no .env editing needed!' },
  'setup-alert':        { de: 'Ã„nderungen werden sofort gespeichert. Kein Neustart nÃ¶tig.', en: 'Changes are saved immediately. No restart needed.' },
  'setup-server-ids':   { de: 'Server IDs',        en: 'Server IDs' },
  'setup-role-ids':     { de: 'Rollen IDs',        en: 'Role IDs' },
  'setup-ticket':       { de: 'Ticket Einstellungen', en: 'Ticket Settings' },
  'setup-channels':     { de: 'Benachrichtigungs-Channels', en: 'Notification Channels' },
  'setup-appearance':   { de: 'Erscheinungsbild',  en: 'Appearance' },
  'btn-save':           { de: 'Speichern',         en: 'Save' },
  'btn-reload':         { de: 'Neu laden',         en: 'Reload' },
  // logs
  'logs-sub':           { de: 'Konfiguriere wo welche Logs landen.', en: 'Configure where each type of log gets posted.' },
  // subs
  'subs-sub':           { de: 'Anime, Twitch, YouTube und Driver Alerts.', en: 'Anime, Twitch, YouTube and driver alerts.' },
  'subs-add':           { de: 'Subscription hinzufÃ¼gen', en: 'Add Subscription' },
  'subs-active':        { de: 'Aktive Subscriptions', en: 'Active Subscriptions' },
  'subs-none':          { de: 'Keine Subscriptions.', en: 'No subscriptions.' },
  // warfeed
  'wf-sub':             { de: 'Automatische Konflikt-News in Discord Threads.', en: 'Automatic conflict news in Discord threads.' },
  'wf-enable':          { de: 'Konflikte aktivieren', en: 'Enable Conflicts' },
  'wf-hint':            { de: 'Threads werden automatisch pro Konflikt erstellt', en: 'Threads are created automatically per conflict' },
  // custom cmds
  'cc-sub':             { de: 'Eigene Trigger und Antworten.', en: 'Custom triggers and responses.' },
  'cc-add':             { de: 'Command hinzufÃ¼gen', en: 'Add Command' },
  'cc-active':          { de: 'Aktive Commands',   en: 'Active Commands' },
  'cc-response':        { de: 'Antwort',           en: 'Response' },
  'cc-match':           { de: 'Match-Typ',         en: 'Match Type' },
  'cc-none':            { de: 'Keine Custom Commands.', en: 'No custom commands.' },
  // giveaway
  'ga-sub':             { de: 'Giveaways starten und verwalten.', en: 'Start and manage giveaways.' },
  'ga-new':             { de: 'Neues Giveaway',    en: 'New Giveaway' },
  'ga-prize':           { de: 'Preis',             en: 'Prize' },
  'ga-duration':        { de: 'Dauer (Minuten)',   en: 'Duration (minutes)' },
  'ga-winners':         { de: 'Anzahl Gewinner',   en: 'Number of Winners' },
  'ga-start':           { de: 'Starten',           en: 'Start' },
  'ga-active':          { de: 'Aktive Giveaways',  en: 'Active Giveaways' },
  'ga-past':            { de: 'Vergangene Giveaways', en: 'Past Giveaways' },
  'ga-ends':            { de: 'Endet',             en: 'Ends' },
  'ga-entries':         { de: 'EintrÃ¤ge',          en: 'Entries' },
  'ga-end-btn':         { de: 'Beenden',           en: 'End' },
  // tickets
  'tk-sub':             { de: 'Ãœbersicht aller Support-Tickets.', en: 'Overview of all support tickets.' },
  'tk-alert':           { de: 'Tickets werden auf Discord verwaltet. Hier siehst du die Ãœbersicht.', en: 'Tickets are managed on Discord. This is a read-only overview.' },
  'tk-open-stat':       { de: 'Offen',             en: 'Open' },
  'tk-closed-stat':     { de: 'Geschlossen',       en: 'Closed' },
  'tk-total-stat':      { de: 'Gesamt',            en: 'Total' },
  'tk-open-list':       { de: 'Offene Tickets',    en: 'Open Tickets' },
  'tk-created':         { de: 'Erstellt',          en: 'Created' },
  'remove':             { de: 'Entfernen',         en: 'Remove' },
};

function t(key) { return (TRANSLATIONS[key] || {})[currentLang] || (TRANSLATIONS[key] || {})['de'] || key; }

function applyLang() {
  // All elements with data-i18n
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    el.innerHTML = t(key);
  });
  // Lang button label
  const btn = document.getElementById('langBtn');
  if (btn) btn.textContent = currentLang === 'de' ? 'ENG' : 'DEU';
  // html lang attr
  document.documentElement.lang = currentLang;
}

function toggleLang() {
  currentLang = currentLang === 'de' ? 'en' : 'de';
  localStorage.setItem('dkos-lang', currentLang);
  applyLang();
  // Re-render conflict grid for translated labels
  renderConflictGrid();
}

// â•â• THEME â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  const btn = document.getElementById('themeBtn');
  if (btn) btn.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
  const logoSrc = theme === 'dark' ? '../assets/logo.png' : '../assets/logo_white.png';
  ['sidebarLogo','loginLogo'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.src = logoSrc;
  });
}

function toggleTheme() {
  const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
  localStorage.setItem('dkos-theme', next);
  applyTheme(next);
}

// â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function show(id, btn) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  if (btn) btn.classList.add('active');
  if (id==='giveaway')      loadGiveaways();
  if (id==='subscriptions') loadSubs();
  if (id==='logs')          loadSettings();
  if (id==='tickets')       loadTickets();
  if (id==='customcmds')    loadCustomCmds();
  if (id==='overview')      loadStats();
}

// â•â• API HELPER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function api(method, path, body) {
  const opts = { method, headers: {'Content-Type':'application/json', Authorization:'Bearer '+accessToken} };
  if (body) opts.body = JSON.stringify(body);
  const res = await fetch(CONFIG.apiUrl + path, opts);
  return res.json();
}

// â•â• STATS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadStats() {
  try {
    const d = await api('GET', '/api/stats?guild='+CONFIG.guildId);
    const s = (id,v) => { const el=document.getElementById(id); if(el) el.textContent=v??'â€”'; };
    s('dMembers',d.members); s('dTickets',d.ticketCount); s('dMessages',d.msgCount);
    s('dJoins',d.joins); s('dLeaves',d.leaves); s('dUptime',fmtUptime(d.uptime));
    s('sBotVersion',d.botVersion||'â€”'); s('sBotName',d.botName||'â€”');
    document.getElementById('sApiStatus').innerHTML = '<span class="pill pill-green">ğŸŸ¢ Online</span>';
  } catch {
    document.getElementById('sApiStatus').innerHTML = '<span class="pill pill-red">ğŸ”´ Offline</span>';
  }
}
function fmtUptime(s) {
  if (!s) return 'â€”';
  return Math.floor(s/86400)+'d '+Math.floor((s%86400)/3600)+'h '+Math.floor((s%3600)/60)+'m';
}

// â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SFIELDS = ['community_server_id','team_server_id','admin_role_id','team_role_id','moderator_role_id',
  'ticket_category_id','ticket_log_channel_id','giveaway_channel_id','war_feed_channel_id','anime_channel_id',
  'counting_channel_id','driver_channel_id','twitch_channel_id','youtube_channel_id','announce_channel_id',
  'bot_name','bot_color','welcome_message'];
const LFIELDS = {reports:'l_reports',server:'l_server',voice:'l_voice',member:'l_member',message:'l_message',invite:'l_invite'};

async function loadSettings() {
  const saved = localStorage.getItem('dkos_settings');
  if (saved) { try { const d=JSON.parse(saved); applyFields(d); } catch {} }
  try { const d = await api('GET','/api/settings'); applyFields(d); } catch {}
}
function applyFields(d) {
  SFIELDS.forEach(f => { const el=document.getElementById('s_'+f); if(el&&d[f]) el.value=d[f]; });
  Object.entries(LFIELDS).forEach(([k,id]) => { const el=document.getElementById(id); if(el&&d['log_'+k+'_ch']) el.value=d['log_'+k+'_ch']; });
}
async function saveSettings() {
  const body = {};
  SFIELDS.forEach(f => { const el=document.getElementById('s_'+f); if(el) body[f]=el.value; });
  localStorage.setItem('dkos_settings', JSON.stringify(body));
  try { const d=await api('POST','/api/settings',body); toast(d.success?'âœ… Gespeichert & synchronisiert!':'âœ… Lokal. API: '+d.error); }
  catch { toast('âœ… Lokal gespeichert.'); }
}
async function saveLogs() {
  const body = {};
  Object.entries(LFIELDS).forEach(([k,id])=>{ const el=document.getElementById(id); if(el) body['log_'+k+'_ch']=el.value; });
  try { const d=await api('POST','/api/settings',body); toast(d.success?'âœ… Log Channels gespeichert!':'âŒ '+d.error); }
  catch { toast('âŒ API nicht erreichbar.'); }
}

// â•â• SUBSCRIPTIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadSubs() {
  const tbody = document.getElementById('subsTbl');
  try {
    const data = await api('GET','/api/subscriptions?guild='+CONFIG.guildId);
    if (!data.length) { tbody.innerHTML='<tr><td class="tbl-empty" colspan="4">Keine Subscriptions.</td></tr>'; return; }
    tbody.innerHTML = data.map(s=>`<tr>
      <td><span class="pill pill-purple">${esc(s.type)}</span></td>
      <td>${esc(s.target)}</td>
      <td><code style="font-size:0.75rem;color:var(--text-dim)">${esc(s.channel_id)}</code></td>
      <td><button class="btn btn-danger btn-sm" onclick="delSub(${s.id})">Entfernen</button></td>
    </tr>`).join('');
  } catch { tbody.innerHTML='<tr><td class="tbl-empty" colspan="4">âŒ API nicht erreichbar.</td></tr>'; }
}
async function addSub() {
  const body = { guildId:CONFIG.guildId, type:document.getElementById('sub_type').value, target:document.getElementById('sub_target').value.trim(), channelId:document.getElementById('sub_channel').value.trim() };
  if (!body.target||!body.channelId) { toast('âŒ Alle Felder ausfÃ¼llen!'); return; }
  try { const d=await api('POST','/api/subscriptions',body); toast(d.success?'âœ… HinzugefÃ¼gt!':'âŒ '+(d.error||'Fehler')); if(d.success) loadSubs(); }
  catch { toast('âŒ API nicht erreichbar.'); }
}
async function delSub(id) {
  try { await api('DELETE','/api/subscriptions/'+id); toast('âœ… Entfernt.'); loadSubs(); }
  catch { toast('âŒ Fehler.'); }
}

// â•â• GIVEAWAYS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadGiveaways() {
  const tbody=document.getElementById('gaTbl'), pastTbody=document.getElementById('gaPastTbl');
  try {
    const data = await api('GET','/api/giveaways?guild='+CONFIG.guildId);
    tbody.innerHTML = !data.active?.length
      ? '<tr><td class="tbl-empty" colspan="5">Keine aktiven Giveaways.</td></tr>'
      : data.active.map(g=>`<tr><td><strong>${esc(g.prize)}</strong></td><td>${new Date(g.ends_at*1000).toLocaleString('de-DE')}</td><td>${tryParse(g.entries)}</td><td>${g.winners}</td><td><button class="btn btn-danger btn-sm" onclick="endGiveaway('${esc(g.message_id)}')">Beenden</button></td></tr>`).join('');
    pastTbody.innerHTML = !data.past?.length
      ? '<tr><td class="tbl-empty" colspan="4">Keine vergangenen Giveaways.</td></tr>'
      : data.past.map(g=>`<tr><td>${esc(g.prize)}</td><td>${new Date(g.ends_at*1000).toLocaleString('de-DE')}</td><td>${tryParse(g.entries)}</td><td>${g.winners}</td></tr>`).join('');
  } catch { tbody.innerHTML='<tr><td class="tbl-empty" colspan="5">âŒ API nicht erreichbar.</td></tr>'; }
}
async function createGiveaway() {
  const prize=document.getElementById('g_prize').value.trim(), channel=document.getElementById('g_channel').value.trim();
  const duration=parseInt(document.getElementById('g_duration').value), winners=parseInt(document.getElementById('g_winners').value);
  if (!prize||!channel) { toast('âŒ Preis und Channel ausfÃ¼llen!'); return; }
  const user=JSON.parse(sessionStorage.getItem('dkos_user')||'{}');
  try { const d=await api('POST','/api/giveaways',{guildId:CONFIG.guildId,channelId:channel,prize,winners,hostId:user.id,durationMs:duration*60000}); toast(d.success?'ğŸ‰ Giveaway gestartet!':'âŒ '+d.error); if(d.success) loadGiveaways(); }
  catch { toast('âŒ API nicht erreichbar.'); }
}
async function endGiveaway(msgId) {
  try { await api('POST','/api/giveaways',{action:'end',messageId:msgId,guildId:CONFIG.guildId}); toast('âœ… Beendet!'); loadGiveaways(); }
  catch { toast('âŒ Fehler.'); }
}

// â•â• TICKETS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadTickets() {
  const tbody=document.getElementById('ticketTbl');
  try {
    const data=await api('GET','/api/tickets?guild='+CONFIG.guildId);
    const open=Array.isArray(data)?data.filter(t=>t.status==='open'):(data.open||[]);
    const closed=Array.isArray(data)?data.filter(t=>t.status==='closed'):(data.closed||[]);
    document.getElementById('tOpen').textContent=open.length;
    document.getElementById('tClosed').textContent=closed.length;
    document.getElementById('tTotal').textContent=open.length+closed.length;
    if (!open.length) { tbody.innerHTML='<tr><td class="tbl-empty" colspan="5">Keine offenen Tickets.</td></tr>'; return; }
    tbody.innerHTML=open.map(t=>`<tr>
      <td><code style="color:var(--accent)">#${t.id}</code></td>
      <td><code style="font-size:0.75rem">${esc(t.user_id)}</code></td>
      <td><code style="font-size:0.75rem">${esc(t.channel_id)}</code></td>
      <td style="color:var(--text-dim)">${new Date(t.created_at*1000).toLocaleString('de-DE')}</td>
      <td><span class="pill pill-green">Offen</span></td>
    </tr>`).join('');
  } catch { tbody.innerHTML='<tr><td class="tbl-empty" colspan="5">âŒ /api/tickets nicht implementiert.</td></tr>'; }
}

// â•â• CUSTOM COMMANDS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadCustomCmds() {
  const tbody=document.getElementById('ccTbl');
  try {
    const data=await api('GET','/api/customcmds?guild='+CONFIG.guildId);
    if (!data.length) { tbody.innerHTML='<tr><td class="tbl-empty" colspan="4">Keine Custom Commands.</td></tr>'; return; }
    tbody.innerHTML=data.map(c=>`<tr>
      <td><code style="color:var(--accent)">${esc(c.trigger)}</code></td>
      <td><span class="pill pill-purple">${esc(c.match)}</span></td>
      <td style="max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(c.response)}</td>
      <td><button class="btn btn-danger btn-sm" onclick="delCustomCmd(${c.id})">Entfernen</button></td>
    </tr>`).join('');
  } catch { tbody.innerHTML='<tr><td class="tbl-empty" colspan="4">âŒ /api/customcmds nicht implementiert.</td></tr>'; }
}
async function addCustomCmd() {
  const body={guildId:CONFIG.guildId,trigger:document.getElementById('cc_trigger').value.trim(),response:document.getElementById('cc_response').value.trim(),match:document.getElementById('cc_match').value};
  if (!body.trigger||!body.response) { toast('âŒ Trigger und Antwort ausfÃ¼llen!'); return; }
  try { const d=await api('POST','/api/customcmds',body); toast(d.success?'âœ… HinzugefÃ¼gt!':'âŒ '+(d.error||'Fehler')); if(d.success) loadCustomCmds(); }
  catch { toast('âŒ API nicht erreichbar.'); }
}
async function delCustomCmd(id) {
  try { await api('DELETE','/api/customcmds/'+id); toast('âœ… Entfernt.'); loadCustomCmds(); }
  catch { toast('âŒ Fehler.'); }
}

// â•â• WAR FEED â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CONFLICTS_INFO=[
  {key:'ukraine',label:'Ukraine War',emoji:'ğŸ‡ºğŸ‡¦'},
  {key:'israel',label:'Israel / Gaza',emoji:'ğŸ‡®ğŸ‡±'},
  {key:'syria',label:'Syria',emoji:'ğŸ‡¸ğŸ‡¾'},
  {key:'global',label:'Global Conflicts',emoji:'ğŸŒ'},
];
function renderConflictGrid() {
  const saved=JSON.parse(localStorage.getItem('dkos_warfeed')||'{}');
  document.getElementById('conflictGrid').innerHTML=CONFLICTS_INFO.map(c=>`
    <div class="conflict-card">
      <div class="conflict-card-top">
        <div class="conflict-name">${c.emoji} ${c.label}</div>
        <label class="toggle"><input type="checkbox" id="wf_${c.key}" ${saved[c.key]?'checked':''} onchange="toggleConflict('${c.key}',this.checked)"><span class="toggle-slider"></span></label>
      </div>
      <div class="conflict-status" id="wf_status_${c.key}">${saved[c.key]?'<span class="pill pill-green">Aktiv</span>':'<span class="pill pill-red">Inaktiv</span>'}</div>
    </div>`).join('');
}
async function toggleConflict(key,enabled) {
  const saved=JSON.parse(localStorage.getItem('dkos_warfeed')||'{}');
  saved[key]=enabled; localStorage.setItem('dkos_warfeed',JSON.stringify(saved));
  document.getElementById('wf_status_'+key).innerHTML=enabled?'<span class="pill pill-green">Aktiv</span>':'<span class="pill pill-red">Inaktiv</span>';
  try { await api('POST','/api/warfeed',{guildId:CONFIG.guildId,conflict:key,enabled}); toast('âœ… '+key+' '+(enabled?'aktiviert':'deaktiviert')+'!'); }
  catch { toast('âœ… Lokal gespeichert.'); }
}
async function saveWarFeedChannel() {
  const ch=document.getElementById('wf_channel').value.trim();
  if (!ch) { toast('âŒ Channel ID eingeben!'); return; }
  try { const d=await api('POST','/api/warfeed/setup',{guildId:CONFIG.guildId,channelId:ch}); toast(d.success?'âœ… Gespeichert!':'âŒ '+d.error); }
  catch { toast('âŒ API nicht erreichbar.'); }
}

// â•â• TOAST & UTILS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function toast(msg) {
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  clearTimeout(toastTimer); toastTimer=setTimeout(()=>el.classList.remove('show'),3500);
}
function esc(s) { return String(s??'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function tryParse(s) { try { return JSON.parse(s||'[]').length; } catch { return 0; } }
</script>
</body>
</html>
